<!DOCTYPE html>

<html>

<head>
    <meta charset='utf-8'>
    <title></title>
    <!-- 引入vue.js -->
    <script src='https://cdn.jsdelivr.net/npm/vue/dist/vue.js'></script>
    <style>
        td {
            width: 200px;
        }
        
        .clearfix::after {
            content: ".";
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }
        
        .float {
            float: left;
        }
    </style>
</head>

<body>
    <div class="app">
        <div class="clearfix">
            <div class="float">
                <label for="">id:</label>
                <input type="text" v-model="id">
            </div>
            <div class="float">
                <label for="">name:</label>
                <input type="text" v-model="name">
            </div>
            <div class="float">
                <input type="button" value="添加" @click="add()">
            </div>
            <div class="float">
                <label for="" @click="search">搜索:</label>
                <input type="text" v-model="keywords">
            </div>
        </div>
        <table class="table table-bordered table-hover table-striped">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Name</th>
                    <th>Ctime</th>
                    <th>Operation</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="(item,index) in search(keywords)" :key="item.id">
                    <td>{{item.id}}</td>
                    <td>{{item.name}}</td>
                    <td>{{item.ctime | myFormat()}}</td>
                    <td>{{item.operation}}</td>
                    <td>
                        <a href="" @click.prevent="del(item.id)">删除</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="app2">
        <div>
            {{ctime | myFormat()}}
        </div>

    </div>
</body>
<script>
    //全局过滤
    //过滤器中的function,第一个参数是过滤器管道符前面传递过来的数据
    //pattern = "" es6用法，如果第二个参数实参没有，形参就为空字符串，pattern就不会报错（不会因为pattern为undefined,toLowerCase()不存在报错）
    Vue.filter('myFormat', function(dateStr, pattern = "") {
        var y = new Date(dateStr).getFullYear();
        var m = new Date(dateStr).getMonth() + 1;
        var d = new Date(dateStr).getDate();
        if (pattern.toLowerCase() == "yy--mm-dd") {
            return `${y}-${m}-${d}`;
        } else {
            var hh = new Date(dateStr).getHours();
            var mm = new Date(dateStr).getMinutes();
            var ss = new Date(dateStr).getSeconds();
            return `${y}-${m}-${d}-${hh}-${mm}-${ss}`;
        }

    })
    var vm = new Vue({
        el: ".app",
        data: {
            id: "",
            name: "",
            keywords: "",
            lists: [{
                id: 1,
                name: "奔驰",
                ctime: new Date()
            }, {
                id: 2,
                name: "奥迪",
                ctime: new Date()
            }],
        },
        methods: {
            add: function() {
                var car = {
                    id: this.id,
                    name: this.name,
                    ctime: this.ctime
                }
                this.lists.push(car)
                this.name = this.id = "";
            },
            del: function(id) {
                this.lists.some((item, i) => {
                    if (item.id == id) {
                        this.lists.splice(i, 1)
                        return true
                    }
                })

            },
            search: function(keywords) {
                var newList = [];
                this.lists.forEach((item) => {
                    if (item.name.indexOf(keywords) != -1) {
                        newList.push(item);
                    }
                });
                return newList;
            }
        }
    })


    //局部过滤
    var vm2 = new Vue({
        el: ".app2",
        data: {
            id: "",
            name: "",
            keywords: "",
            ctime: new Date()
        },
        filters: {
            myFormat: function(dateStr, pattern = "") {
                var y = new Date(dateStr).getFullYear();
                var m = new Date(dateStr).getMonth() + 1;
                var d = new Date(dateStr).getDate();
                if (pattern.toLowerCase() == "yy--mm-dd") {
                    return `${y}-${m}-${d} ~~`;
                } else {
                    var hh = new Date(dateStr).getHours();
                    var mm = new Date(dateStr).getMinutes();
                    var ss = new Date(dateStr).getSeconds();
                    return `${y}-${m}-${d}-${hh}-${mm}-${ss}`;
                }
            }
        }
    })
</script>